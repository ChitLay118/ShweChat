<!-- index.html -->
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>ShweMyanmar - Login</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<nav><div class="container">ShweMyanmar</div></nav>

<div class="container">
  <div class="center-card" id="authCard">
    <h2 id="authTitle">Login</h2>

    <input id="nameInput" type="text" placeholder="Full name (register only)" style="display:none">
    <input id="emailInput" type="email" placeholder="Email">
    <input id="passwordInput" type="password" placeholder="Password">

    <div style="display:flex;gap:8px;margin-top:12px">
      <button id="primaryBtn">Login</button>
      <button id="toggleBtn" class="ghost">Switch to Register</button>
    </div>

    <p class="small" style="margin-top:10px">
      <a href="#" id="forgotLink">Forgot password?</a>
    </p>
    <p id="authMsg" class="small" style="color:red"></p>
  </div>
</div>

<script type="module">
import {
  auth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
  sendPasswordResetEmail, updateProfile, onAuthStateChanged
} from './firebase.js';

// simple auth UI state
let isRegister = false;
const emailInput = document.getElementById('emailInput');
const pwdInput = document.getElementById('passwordInput');
const nameInput = document.getElementById('nameInput');
const primaryBtn = document.getElementById('primaryBtn');
const toggleBtn = document.getElementById('toggleBtn');
const forgotLink = document.getElementById('forgotLink');
const authMsg = document.getElementById('authMsg');
const authTitle = document.getElementById('authTitle');

toggleBtn.addEventListener('click', () => {
  isRegister = !isRegister;
  nameInput.style.display = isRegister ? 'block' : 'none';
  primaryBtn.textContent = isRegister ? 'Register' : 'Login';
  toggleBtn.textContent = isRegister ? 'Switch to Login' : 'Switch to Register';
  authTitle.textContent = isRegister ? 'Create account' : 'Login';
  authMsg.textContent = '';
});

primaryBtn.addEventListener('click', async () => {
  authMsg.textContent = '';
  const email = emailInput.value.trim();
  const pwd = pwdInput.value;
  if(!email || !pwd){ authMsg.textContent = 'Please enter email & password'; return; }

  try{
    if(isRegister){
      const name = nameInput.value.trim() || 'User';
      const res = await createUserWithEmailAndPassword(auth, email, pwd);
      await updateProfile(res.user, { displayName: name });
      // create user doc
      await import('./app.js').then(m => m.createUserDoc(res.user));
      window.location = 'feed.html';
    } else {
      await signInWithEmailAndPassword(auth, email, pwd);
      window.location = 'feed.html';
    }
  }catch(e){
    authMsg.textContent = e.message;
  }
});

forgotLink.addEventListener('click', async (e) => {
  e.preventDefault();
  const email = emailInput.value.trim();
  if(!email){ authMsg.textContent = 'Enter your email first.'; return; }
  try{
    await sendPasswordResetEmail(auth, email);
    authMsg.style.color = 'green';
    authMsg.textContent = 'Reset email sent.';
  }catch(e){
    authMsg.style.color = 'red';
    authMsg.textContent = e.message;
  }
});

// redirect if already logged in
onAuthStateChanged(auth, u => {
  if(u) window.location = 'feed.html';
});
</script>
</body>
</html>
